---
layout: post
title: Working Now Tutors via Google Calendar
tags: cissandbox
categories: developer
date:   2017-01-30 15:05:14 -0500
comments: true
--- 
 
<html>
  <head>
    <title>Working Now Tutors</title>
      <meta charset='utf-8' />
      <script
              src="https://code.jquery.com/jquery-2.2.4.min.js"
              integrity="sha256-BbhdlvQf/xTY9gja0Dq3HiwQF8LaCRTXxZKRutelT44="
              crossorigin="anonymous"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-timepicker/1.10.0/jquery.timepicker.min.js"></script>
      <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/jquery-timepicker/1.10.0/jquery.timepicker.min.css" />
      <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.6.4/js/bootstrap-datepicker.min.js"></script>
      <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.5.0/css/bootstrap-datepicker.standalone.css">

      <link rel="stylesheet" href="https://ajax.googleapis.com/ajax/libs/jqueryui/1.7.2/themes/ui-lightness/jquery-ui.css" type="text/css" media="all">
      <script src="http://jonthornton.github.io/Datepair.js/dist/datepair.js"></script>
      <script src="http://jonthornton.github.io/Datepair.js/dist/jquery.datepair.js"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.17.1/moment.min.js"></script>
      <style>
          body {
              height:100%;
          }
          .tutors {
              display: inline-block;
              margin-right: 30px;
          }
          .notutors {
              font-size: 1.25em;
              color: #964242;
          }
          #title {
              margin-bottom: 0;
          }
          #onSelect {
              margin-bottom: .75rem;
          }
          #onSelectDate {
              width: 120px;
              font-size: 1em;
          }
          #onSelectTime {
              width: 100px;
              font-size: 1em;
          }
          #apply {
              padding:5px;
              background-color: #fff;
              border: 1px solid #ddd;
              font-family: inherit;
              cursor: pointer;
              margin: 12px 0 0 0;
              display: inline-block;
              font-size: 14px;
          }
          #now {
              padding:5px;
              background-color: #fff;
              border: 1px solid #ddd;
              font-family: inherit;
              cursor: pointer;
              margin: 12px 0 0 8px;
              display: inline-block;
              font-size: 14px;
          }
      </style>
  </head>
   <body>
   <p id="title"><b>Select a date & time:</b></p>
    <p id="onSelect">
        <input id="onSelectDate" type="text" class="date start" />
        <input id="onSelectTime" type="text" class="time start" />
        <br />
        <button id="apply">Apply Time</button>
        <button id="now">Now</button>
        <br />
        <small>* Select date only to show all tutors work on that day</small>
        <br />
        <small>** Source: CIS Sandbox Group Calendar</small>
    </p>
    <br />
    <p id="tutors"></p>

    <script type="text/javascript">
        // author: Max Xu (xujialv@gmail.com)

        var baseURL = "https://www.googleapis.com/calendar/v3/calendars/bentleycis@gmail.com/events?&singleEvents=true&timeMin=";
        var APIKey = "&key=AIzaSyCfry1igXqQBivX0uiIzOiwdMyJV2F32XY";
        var currentTime = moment().format("YYYY-MM-DDTHH:mm:ssZ");
        var timeMax = moment().endOf('day').format("YYYY-MM-DDTHH:mm:ssZ");
        var todayEvents = [];
        var imageBaseURL = "http://cis.bentley.edu/sandbox/wp-content/uploads/TutorImage/";
        var imageSize = "-150x150.jpg";

        function init() {
            $('.notutors').remove();
            todayEvents = []; // clear for re-init
            $.getJSON(baseURL + currentTime + "&timeMax=" + timeMax + APIKey, function(data){
            $.extend(todayEvents, data.items);
            }).done(function() {
                var n = 0;
                for (i=0;i<todayEvents.length;i++) {
                    if (todayEvents[i].summary.includes("Emily")) {
                        todayEvents[i].summary = "Emilyk"
                    }
                    if (todayEvents[i].summary.toLowerCase().includes("nicolette")) {
                        todayEvents[i].summary = "Nicollette"
                    }
                    if (currentTime >= todayEvents[i].start.dateTime && currentTime <= todayEvents[i].end.dateTime || currentTime.substr(11) == "00:00:00-05:00") {
                        $('#tutors').append('<div class="tutors"><p>' + todayEvents[i].summary + '</p>' + '<img src="' + imageBaseURL + todayEvents[i].summary.toLowerCase().replace(" ", "") + imageSize + '"/></div>');
                    } else {
                        n += 1;
                    }
                  }
                    if (n === todayEvents.length) {
                        $('#tutors').append('<div class="notutors"><p>There is no tutor working at this time</p></div>');
                    }
                }
            );
        }

        init();


        $('#onSelect .time').timepicker({
            'showDuration': false,
            'timeFormat': 'H:i',
            'minTime': '10:00',
            'maxTime': '23:00'
        });
        $('#onSelect .date').datepicker({
            'format': 'yyyy-mm-dd',
            'autoclose': true,
             startDate : new Date()
        });

        $('#onSelect').datepair(); 

        $('#apply').click(function() {
            if ($('#onSelectDate').val() !== "" && $('#onSelectTime').val() !== "") {
                var $date = $('#onSelectDate').val() + "T";
                var $time = $('#onSelectTime').val() + ":00-05:00";
                currentTime = $date + $time;
                timeMax = $date + moment().endOf('day').format("YYYY-MM-DDTHH:mm:ssZ").slice(11);
                $('.tutors').remove();
                init();
            } else if ($('#onSelectDate').val() !== "" && $('#onSelectTime').val() == "") {
                var $date = $('#onSelectDate').val() + "T";
                var $time = $('#onSelectTime').val() + ":00-05:00";
                currentTime = $date + moment().startOf('day').format("YYYY-MM-DDTHH:mm:ssZ").slice(11);
                timeMax = $date + moment().endOf('day').format("YYYY-MM-DDTHH:mm:ssZ").slice(11);
                $('.tutors').remove();
                init();
            }
        });

        $('#now').click(function() {
                $('#onSelectDate').val('');
                $('#onSelectTime').val('');
                currentTime = moment().format("YYYY-MM-DDTHH:mm:ssZ");
                timeMax = moment().endOf('day').format("YYYY-MM-DDTHH:mm:ssZ");
                $('.tutors').remove();
                init();
        });

       </script>
  </body>
</html>